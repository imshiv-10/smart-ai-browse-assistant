import{b as s}from"./browser-polyfill-DY9jeWLg.js";import{S as d,A as l}from"./storage-CReADF-2.js";const i=new d;let r;async function g(){const t=await i.getSettings();r=new l(t),chrome.sidePanel&&chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!1}),console.log("Smart Browse Assistant initialized")}s.runtime.onMessage.addListener((t,e)=>{var n,a;switch(t.type){case"GET_PAGE_CONTENT":return w((n=e.tab)==null?void 0:n.id);case"SUMMARIZE":return f(t.payload);case"COMPARE_PRODUCT":return h(t.payload);case"CHAT":return L(t.payload);case"GET_SETTINGS":return i.getSettings();case"UPDATE_SETTINGS":return m(t.payload);case"OPEN_SIDE_PANEL":return u((a=e.tab)==null?void 0:a.id);default:console.warn("Unknown message type:",t.type);return}});async function w(t){var e;if(t||(t=(e=(await s.tabs.query({active:!0,currentWindow:!0}))[0])==null?void 0:e.id),!t)return null;try{return await s.tabs.sendMessage(t,{type:"EXTRACT_CONTENT"})}catch(n){return console.error("Failed to get page content:",n),null}}async function f(t){const e=await i.getSettings(),n=t.text.length;if(e.useLocalLLM&&n<e.localLLMThreshold)try{return await r.summarizeLocal(t)}catch(a){console.warn("Local LLM failed, falling back to backend:",a)}return await r.summarizeRemote(t)}async function h(t){return await r.compareProduct(t.url,t.content)}async function L(t){const e=await i.getSettings(),n=t.context.text.length;if(e.useLocalLLM&&n<e.localLLMThreshold)try{return await r.chatLocal(t.messages,t.context)}catch(a){console.warn("Local LLM failed, falling back to backend:",a)}return await r.chatRemote(t.messages,t.context)}async function m(t){const e=await i.updateSettings(t);return r=new l(e),e}async function u(t){chrome.sidePanel&&t&&await chrome.sidePanel.open({tabId:t})}s.runtime.onInstalled.addListener(async t=>{t.reason==="install"&&(await i.setDefaultSettings(),console.log("Extension installed, default settings applied"))});var o,c;(c=(o=s.commands)==null?void 0:o.onCommand)==null||c.addListener(async t=>{var e;if(t==="toggle-sidebar"){const a=(e=(await s.tabs.query({active:!0,currentWindow:!0}))[0])==null?void 0:e.id;a&&await u(a)}});g();
