import{b as u}from"./browser-polyfill-DY9jeWLg.js";u.runtime.onMessage.addListener(r=>{if(r.type==="EXTRACT_CONTENT")return Promise.resolve(d())});function d(){const r=l(),t={url:window.location.href,title:document.title,description:m(),text:s(),pageType:r,extractedAt:new Date().toISOString()};return r==="product"&&(t.product=p()),r==="article"&&(t.article=v()),t}function l(){const r=window.location.href.toLowerCase(),t=window.location.hostname;return[/\/product\//i,/\/item\//i,/\/dp\//i,/\/p\//i,/\/pd\//i,document.querySelector('[itemtype*="schema.org/Product"]'),document.querySelector('[typeof="Product"]'),document.querySelector("[data-product-id]"),document.querySelector('.product-price, .price, [class*="price"]'),document.querySelector('button[class*="cart"], button[class*="buy"]')].some(Boolean)?"product":[document.querySelector("article"),document.querySelector('[itemtype*="schema.org/Article"]'),document.querySelector('[itemtype*="schema.org/NewsArticle"]'),document.querySelector('[itemtype*="schema.org/BlogPosting"]'),document.querySelector(".article-content, .post-content, .entry-content")].some(Boolean)?"article":r.includes("search")||r.includes("q=")||r.includes("query=")||t.includes("google")||t.includes("bing")||t.includes("duckduckgo")?"search":"other"}function m(){const r=document.querySelector('meta[name="description"]'),t=document.querySelector('meta[property="og:description"]');return(r==null?void 0:r.getAttribute("content"))||(t==null?void 0:t.getAttribute("content"))||""}function s(){const r=["main","article",'[role="main"]',".main-content",".content",".post-content",".article-content",".entry-content","#content","#main"];let t=null;for(const i of r)if(t=document.querySelector(i),t)break;t||(t=document.body);const e=t.cloneNode(!0);["script","style","nav","header","footer","aside",".sidebar",".advertisement",".ad",'[role="banner"]','[role="navigation"]','[role="complementary"]',".comments",".comment-section",".social-share",".related-posts"].forEach(i=>{e.querySelectorAll(i).forEach(a=>a.remove())});let n=e.textContent||"";n=n.replace(/\s+/g," ").replace(/\n\s*\n/g,`
`).trim();const c=5e4;return n.length>c&&(n=n.substring(0,c)+"..."),n}function p(){return{name:f(),price:g(),currency:y(),images:b(),description:x(),rating:S(),reviewCount:h(),availability:C(),brand:q(),category:w()}}function f(){var t;const r=['[itemprop="name"]','h1[class*="product"]','h1[class*="title"]',".product-title",".product-name","#productTitle",'[data-testid="product-title"]',"h1"];for(const e of r){const o=document.querySelector(e);if((t=o==null?void 0:o.textContent)!=null&&t.trim())return o.textContent.trim()}return document.title}function g(){const r=['[itemprop="price"]',".price",".product-price",'[class*="price"]','[data-testid*="price"]',"#priceblock_ourprice","#priceblock_dealprice",".a-price .a-offscreen"];for(const t of r){const e=document.querySelector(t),c=((e==null?void 0:e.getAttribute("content"))||(e==null?void 0:e.textContent)||"").match(/[\d,]+\.?\d*/);if(c)return parseFloat(c[0].replace(/,/g,""))}}function y(){var e;const r=document.querySelector('[itemprop="priceCurrency"]');if(r)return r.getAttribute("content")||"USD";const t=((e=document.querySelector('.price, [class*="price"]'))==null?void 0:e.textContent)||"";return t.includes("$")?"USD":t.includes("€")?"EUR":t.includes("£")?"GBP":t.includes("¥")?"JPY":"USD"}function b(){const r=[],t=['[itemprop="image"]',".product-image img",'[class*="product"] img','[data-testid*="image"] img',"#landingImage"];for(const e of t)document.querySelectorAll(e).forEach(o=>{const n=o.getAttribute("src")||o.getAttribute("data-src");n&&!n.includes("placeholder")&&r.push(n)});return r.slice(0,5)}function x(){var t;const r=['[itemprop="description"]',".product-description",".description","#productDescription",'[data-testid="product-description"]'];for(const e of r){const o=document.querySelector(e);if((t=o==null?void 0:o.textContent)!=null&&t.trim())return o.textContent.trim().substring(0,2e3)}return""}function S(){const r=['[itemprop="ratingValue"]',".rating",'[class*="rating"]','[data-testid*="rating"]'];for(const t of r){const e=document.querySelector(t),n=((e==null?void 0:e.getAttribute("content"))||(e==null?void 0:e.textContent)||"").match(/(\d+\.?\d*)/);if(n){const c=parseFloat(n[1]);if(c>0&&c<=5)return c}}}function h(){const r=['[itemprop="reviewCount"]',".review-count",'[class*="review"]',"#acrCustomerReviewText"];for(const t of r){const e=document.querySelector(t),n=((e==null?void 0:e.getAttribute("content"))||(e==null?void 0:e.textContent)||"").match(/(\d+[\d,]*)/);if(n)return parseInt(n[1].replace(/,/g,""),10)}}function C(){const r=['[itemprop="availability"]',".availability","#availability",'[data-testid*="availability"]'];for(const t of r){const e=document.querySelector(t),o=(e==null?void 0:e.getAttribute("content"))||(e==null?void 0:e.textContent)||"";if(o.toLowerCase().includes("in stock"))return"in_stock";if(o.toLowerCase().includes("out of stock"))return"out_of_stock"}return"unknown"}function q(){var t;const r=['[itemprop="brand"]',".brand",'[class*="brand"]',"#bylineInfo"];for(const e of r){const o=document.querySelector(e);if((t=o==null?void 0:o.textContent)!=null&&t.trim())return o.textContent.trim()}return""}function w(){var t;const r=['[itemprop="category"]',".breadcrumb",'[class*="breadcrumb"]','nav[aria-label="Breadcrumb"]'];for(const e of r){const o=document.querySelector(e);if((t=o==null?void 0:o.textContent)!=null&&t.trim())return o.textContent.trim().replace(/\s*[>\/]\s*/g," > ")}return""}function v(){return{author:A(),publishDate:P(),readingTime:T()}}function A(){var t;const r=['[itemprop="author"]','[rel="author"]',".author",".byline",'[class*="author"]'];for(const e of r){const o=document.querySelector(e);if((t=o==null?void 0:o.textContent)!=null&&t.trim())return o.textContent.trim()}return""}function P(){var t;const r=['[itemprop="datePublished"]',"time[datetime]",".publish-date",".post-date",'[class*="date"]'];for(const e of r){const o=document.querySelector(e),n=o==null?void 0:o.getAttribute("datetime");if(n)return n;if((t=o==null?void 0:o.textContent)!=null&&t.trim())return o.textContent.trim()}return""}function T(){const t=s().split(/\s+/).length;return Math.ceil(t/200)}export{l as detectPageType,d as extractPageContent,p as extractProductInfo};
